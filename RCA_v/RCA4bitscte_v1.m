% Matlab M-file converted by [Custom WaveView] saved 14:42:27 Mon Apr 20 2020

clear
close all
clc

TIME = [ 0.000E+00  1.000E-12  2.000E-12  2.180E-12  2.266E-12  2.544E-12  3.135E-12  3.996E-12  5.337E-12  7.319E-12  1.017E-11  1.457E-11  2.102E-11  2.958E-11  3.548E-11  4.137E-11  4.825E-11  5.147E-11  5.469E-11  6.095E-11  6.673E-11  7.791E-11  9.245E-11  1.095E-10  1.302E-10  1.595E-10  2.058E-10  2.353E-10  2.773E-10  3.743E-10  4.743E-10  5.743E-10  6.743E-10  7.743E-10  8.743E-10  9.743E-10  1.074E-09  1.174E-09  1.274E-09  1.374E-09  1.474E-09  1.574E-09  1.674E-09  1.774E-09  1.874E-09  1.974E-09  1.999E-09  1.999E-09  2.000E-09  2.000E-09 ];
v___A_0___ = [ 1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  9.000E-01  6.590E-01  6.000E-01 ];
v___A_1___ = [ 1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00 ];
v___A_2___ = [ 1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  9.000E-01  6.590E-01  6.000E-01 ];
v___A_3___ = [ 0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  3.000E-01  5.410E-01  6.000E-01 ];
v___B_0___ = [ 1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  9.000E-01  6.590E-01  6.000E-01 ];
v___B_1___ = [ 1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00 ];
v___B_2___ = [ 1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  9.000E-01  6.590E-01  6.000E-01 ];
v___B_3___ = [ 0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00 ];
v___S_0___ = [ 2.351E-05  4.339E-02  4.969E-02  3.557E-02  2.891E-02  1.169E-02 -9.297E-03 -1.956E-02 -1.872E-02 -1.507E-02 -1.351E-02 -1.326E-02 -6.530E-03  5.782E-02  3.236E-01  7.701E-01  1.132E+00  1.190E+00  1.177E+00  1.186E+00  1.192E+00  1.197E+00  1.199E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.190E+00  1.181E+00  1.179E+00 ];
v___S_1___ = [ 1.200E+00  1.201E+00  1.201E+00  1.201E+00  1.201E+00  1.200E+00  1.200E+00  1.199E+00  1.199E+00  1.199E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.199E+00  1.198E+00  1.198E+00 ];
v___S_2___ = [ 1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.185E+00  1.174E+00  1.171E+00 ];
v___S_3___ = [ 1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.203E+00  1.206E+00  1.207E+00 ];
Ci = [ 0.000E+00  6.000E-01  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00  1.200E+00 ];
Co = [ 2.351E-05  2.355E-05  2.353E-05  2.348E-05  2.347E-05  2.344E-05  2.344E-05  2.339E-05  2.340E-05  2.342E-05  2.331E-05  2.330E-05  2.340E-05  2.336E-05  2.336E-05  2.338E-05  2.336E-05  2.336E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  2.337E-05  4.993E-03  8.540E-03  9.292E-03 ];

n = 4;

Ci = Ci(floor(length(TIME)/2));
Co = Co(floor(length(TIME)/2));

idx = (Ci>0.5);
Ci(idx) = 1;
Ci(~idx) = 0;
idx = (Co>1);
Co(idx) = 1;
Co(~idx) = 0;

A = [];
B = [];
Sum = [];
Cin = Ci;
Cout = 0;

for r = 1:n
    A = [A eval(sprintf('v___A_%d___(%d)', r-1, floor(length(TIME)/2)))];
    B = [B eval(sprintf('v___B_%d___(%d)', r-1, floor(length(TIME)/2)))];
    Sum = [Sum eval(sprintf('v___S_%d___(%d)', r-1, floor(length(TIME)/2)))];
end

idx = (A>0.5);
A(idx) = 1;
A(~idx) = 0;
idx = (B>0.5);
B(idx) = 1;
B(~idx) = 0;
idx = (Sum>1);
Sum(idx) = 1;
Sum(~idx) = 0;

S = A+B;
S(1) = S(1) + Cin;

% figure
% stem(S);
% title('Suma 1')

for m = 1:n-1
    for r = 1:n-1
        if(S(r) > 1)
            S(r) = S(r)-2;
            S(r+1) = S(r+1) + 1;
        end
    end
end

if(S(n) == 2)
    Cout = Cout + 1;
    S(n) = 0;
end

if(S(n) == 3)
    Cout = Cout + 1;
    S(n) = 1;
end

% figure
% stem(S);
% title('Suma 2')
% figure
% stem(Sum)
% title('Sum')

res = S-Sum;
idx = (res>0.5);
res(idx) = 1;
res(~idx) = 0;

error = false;

for r = 1:n
    if(res(r) ~= 0)
        sprintf('Hay un error en la suma en el dígito %d', r)
        error = true;
    end
end

if(~error)
    sprintf('No hay errores en la Suma')
end

if(Cout ~= Co)
    sprintf('Hay un error en el Carry out')
else
    sprintf('No hay errores en el Carry Out')
end
